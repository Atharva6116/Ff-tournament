<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tournaments - FF Tournament Pro</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="header">
    <h2>Welcome to FF Tournament Pro</h2>
    <div id="wallet">Wallet: ₹0</div>
  </div>

  <div id="tournamentsContainer" class="tournaments"></div>

  <script src="data.js"></script>
  <script>
    const mobile = localStorage.getItem("mobile");
    if (!mobile) {
      alert("Please login first.");
      window.location.href = "login.html";
    }

    const user = users.find(u => u.mobile === mobile);
    if (!user) {
      alert("User not found. Please register.");
      window.location.href = "login.html";
    }

    // Display wallet balance
    const walletDiv = document.getElementById("wallet");
    walletDiv.innerText = `Wallet: ₹${user.wallet}`;

    const container = document.getElementById("tournamentsContainer");

    tournaments.forEach((tournament, index) => {
      const card = document.createElement("div");
      card.className = "tournament-card";
      card.innerHTML = `
        <h3>${tournament.name}</h3>
        <p>Prize: ₹${tournament.prize}</p>
        <p>Time: ${tournament.time}</p>
        <p id="joined-${index}">Players Joined: ${tournament.joined}</p>
        <button onclick="register(${index})">Register</button>
        <div id="recharge-link-${index}" class="recharge-link" style="margin-top: 5px;"></div>
      `;
      container.appendChild(card);
    });

    function register(index) {
      const tournament = tournaments[index];

      // Check if user already joined
      if (tournament.players.includes(user.mobile)) {
        alert("Already registered for this tournament.");
        return;
      }

      // Check balance
      if (user.wallet < tournament.entryFee) {
        const linkDiv = document.getElementById(`recharge-link-${index}`);
        linkDiv.innerHTML = `<a href="recharge.html" class="recharge-btn">Insufficient balance. Recharge Wallet</a>`;
        return;
      }

      // Deduct entry fee and register
      user.wallet -= tournament.entryFee;
      tournament.joined += 1;
      tournament.players.push(user.mobile);

      // Update UI
      walletDiv.innerText = `Wallet: ₹${user.wallet}`;
      document.getElementById(`joined-${index}`).innerText = `Players Joined: ${tournament.joined}`;
      alert("Successfully registered!");
    }
  </script>
</body>
</html>
